<h2>Registrarse</h2>

<form [formGroup]="form" (ngSubmit)="register()">

  <label>Usuario</label>
  <input type="text" formControlName="username" placeholder="Usuario">
  
  @if (form.get('username')?.invalid && (form.get('username')?.dirty || form.get('username')?.touched)) {
    <div style="color: red;">
      
      @if (form.get('username')?.hasError('required')) {
        <small>El nombre de usuario es requerido.</small>
      }

      @if (form.get('username')?.hasError('minlength')) {
        <small>El usuario debe tener al menos 3 caracteres.</small>
      }

      @if (form.get('username')?.hasError('usuarioExistente')) {
        <small><b>Error:</b> Este nombre de usuario ya existe. Elige otro.</small>
      }
    </div>
  }

  @if (form.get('username')?.pending) {
    <div style="color: grey;">
      <small>Verificando disponibilidad...</small>
    </div>
  }


  <label>Contraseña</label>
  <input type="password" formControlName="password" placeholder="Contraseña">

  @if (form.get('password')?.invalid && (form.get('password')?.dirty || form.get('password')?.touched)) {
    <div style="color: red;">
      
      @if (form.get('password')?.hasError('required')) {
        <small>La contraseña es requerida.</small>
      }

      @if (form.get('password')?.hasError('minlength')) {
        <small>La contraseña debe tener al menos 6 caracteres.</small>
      }

      @if (form.get('password')?.hasError('pattern')) {
        <small>La contraseña debe tener al menos un caracter especial (ej: #, ?, !, @, $).</small>
      }

    </div>
  }
  <button type="submit" [disabled]="form.invalid || form.pending">Crear cuenta</button>

  <p>{{ msg }}</p>
</form>